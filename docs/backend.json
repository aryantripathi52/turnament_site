
{
  "entities": {
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a game category for tournaments.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the game category."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL for the category's image.",
          "format": "uri"
        }
      },
      "required": ["id", "name", "imageUrl"]
    },
    "Tournament": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tournament",
      "type": "object",
      "description": "Represents a Free Fire tournament.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tournament entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the tournament."
        },
        "startDate": {
          "type": "string",
          "description": "Date and time when the tournament starts.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date and time when the tournament ends.",
          "format": "date-time"
        },
        "prizePoolFirst": {
          "type": "number",
          "description": "Prize for the 1st place winner."
        },
        "prizePoolSecond": {
          "type": "number",
          "description": "Prize for the 2nd place winner."
        },
        "prizePoolThird": {
          "type": "number",
          "description": "Prize for the 3rd place winner."
        },
        "entryFee": {
          "type": "number",
          "description": "The entry fee for the tournament in coins."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the tournament."
        },
        "rules": {
          "type": "string",
          "description": "Rules of the tournament."
        },
        "registrationLink": {
          "type": "string",
          "description": "Link to the registration page for the tournament.",
          "format": "uri"
        },
        "contactEmail": {
          "type": "string",
          "description": "Contact email address for the tournament organizer.",
          "format": "email"
        },
        "status": {
          "type": "string",
          "description": "The current status of the tournament.",
          "enum": ["upcoming", "live", "completed", "cancelled"]
        },
        "maxPlayers": {
            "type": "number",
            "description": "Maximum number of players allowed in the tournament."
        },
        "registeredCount": {
            "type": "number",
            "description": "Number of players currently registered for the tournament."
        },
         "roomId": {
          "type": "string",
          "description": "The in-game room ID for the tournament match."
        },
        "roomPassword": {
          "type": "string",
          "description": "The password for the in-game room."
        },
        "winners": {
            "type": "object",
            "properties": {
                "first": {
                    "type": "object",
                    "properties": {
                        "userId": {"type": "string"},
                        "username": {"type": "string"}
                    }
                },
                "second": {
                    "type": "object",
                    "properties": {
                        "userId": {"type": "string"},
                        "username": {"type": "string"}
                    }
                },
                "third": {
                    "type": "object",
                    "properties": {
                        "userId": {"type": "string"},
                        "username": {"type": "string"}
                    }
                }
            }
        },
        "categoryId": {
            "type": "string"
        }
      },
      "required": [
        "id",
        "name",
        "startDate",
        "endDate",
        "prizePoolFirst",
        "prizePoolSecond",
        "prizePoolThird",
        "entryFee",
        "description",
        "rules",
        "registrationLink",
        "contactEmail",
        "status",
        "maxPlayers",
        "registeredCount",
        "categoryId"
      ]
    },
    "Registration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Registration",
      "type": "object",
      "description": "Represents a team's registration for a tournament.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Registration entity."
        },
        "tournamentId": {
          "type": "string",
          "description": "Reference to Tournament. (Relationship: Tournament 1:N Registration)"
        },
        "teamName": {
          "type": "string",
          "description": "Name of the team registering."
        },
        "playerIds": {
          "type": "array",
          "description": "Array of player IDs for registered players",
          "items": {
            "type": "string"
          }
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time when the team registered.",
          "format": "date-time"
        },
        "userId": {"type": "string"},
        "slotNumber": {
          "type": "number",
          "description": "The slot number assigned to the player upon registration."
        }
      },
      "required": [
        "id",
        "tournamentId",
        "teamName",
        "playerIds",
        "registrationDate",
        "userId",
        "slotNumber"
      ]
    },
    "Announcement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Announcement",
      "type": "object",
      "description": "Represents an announcement related to the platform or Free Fire eSports events.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Announcement entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the announcement."
        },
        "content": {
          "type": "string",
          "description": "Content of the announcement."
        },
        "date": {
          "type": "string",
          "description": "Date and time when the announcement was made.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "date"
      ]
    },
    "Highlight": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Highlight",
      "type": "object",
      "description": "Represents an AI-generated match highlight.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Highlight entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the highlight."
        },
        "description": {
          "type": "string",
          "description": "Description of the highlight."
        },
        "videoUrl": {
          "type": "string",
          "description": "URL of the highlight video.",
          "format": "uri"
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time when the highlight was uploaded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "videoUrl",
        "uploadDate"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the platform.  Note that passwords are not stored in this entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user."
        },
        "coins": {
          "type": "number",
          "description": "The number of coins the user has."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "role",
        "coins"
      ]
    },
    "AddCoinRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AddCoinRequest",
      "type": "object",
      "description": "Represents a user's request to add coins. This is the global record for admin review.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "username": { "type": "string" },
        "type": { "type": "string", "enum": ["add"] },
        "amountCoins": { "type": "number" },
        "amountPaid": { "type": "number" },
        "transactionId": { "type": "string" },
        "status": { "type": "string", "enum": ["pending", "approved", "denied"] },
        "requestDate": { "type": "string", "format": "date-time" },
        "decisionDate": { "type": "string", "format": "date-time" }
      },
      "required": ["userId", "username", "type", "amountCoins", "amountPaid", "transactionId", "status", "requestDate"]
    },
     "PlayerAddCoinRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PlayerAddCoinRequest",
      "type": "object",
      "description": "A denormalized copy of a coin addition request, stored in a user's subcollection for their private history.",
      "properties": {
        "id": { "type": "string" },
        "amountCoins": { "type": "number" },
        "status": { "type": "string", "enum": ["pending", "approved", "denied"] },
        "requestDate": { "type": "string", "format": "date-time" }
      },
      "required": ["amountCoins", "status", "requestDate"]
    },
    "WithdrawCoinRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WithdrawCoinRequest",
      "type": "object",
      "description": "Represents a user's request to withdraw coins. This is the global record for admin review.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "username": { "type": "string" },
        "type": { "type": "string", "enum": ["withdraw"] },
        "amountCoins": { "type": "number" },
        "withdrawalDetails": { "type": "string" },
        "status": { "type": "string", "enum": ["pending", "approved", "denied"] },
        "requestDate": { "type": "string", "format": "date-time" },
        "decisionDate": { "type": "string", "format": "date-time" }
      },
      "required": ["userId", "username", "type", "amountCoins", "withdrawalDetails", "status", "requestDate"]
    },
    "PlayerWithdrawCoinRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PlayerWithdrawCoinRequest",
      "type": "object",
      "description": "A denormalized copy of a coin withdrawal request, stored in a user's subcollection for their private history.",
      "properties": {
        "id": { "type": "string" },
        "amountCoins": { "type": "number" },
        "status": { "type": "string", "enum": ["pending", "approved", "denied"] },
        "requestDate": { "type": "string", "format": "date-time" }
      },
      "required": ["amountCoins", "status", "requestDate"]
    },
     "JoinedTournament": {
      "title": "Joined Tournament",
      "type": "object",
      "description": "A denormalized, simplified record of a tournament a user has joined.",
      "properties": {
        "id": { "type": "string", "description": "The ID of the tournament." },
        "name": { "type": "string", "description": "Name of the tournament." },
        "startDate": { "type": "string", "format": "date-time", "description": "When the tournament starts." },
        "prizePoolFirst": { "type": "number", "description": "Prize for 1st place." },
        "entryFee": { "type": "number", "description": "The entry fee paid." },
        "slotNumber": { "type": "number", "description": "The slot number assigned to the user." },
        "roomId": { "type": "string", "description": "The in-game room ID, if available." },
        "roomPassword": { "type": "string", "description": "The in-game room password, if available." }
      },
      "required": ["id", "name", "startDate", "prizePoolFirst", "entryFee", "slotNumber"]
    },
    "WonTournament": {
      "title": "Won Tournament",
      "description": "A denormalized record of a tournament a user has won.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "prizeWon": { "type": "number" },
        "place": { "type": "string", "enum": ["1st", "2nd", "3rd"] },
        "completionDate": { "type": "string", "format": "date-time" }
      },
      "required": ["name", "prizeWon", "place", "completionDate"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/tournaments/{tournamentId}",
        "definition": {
          "entityName": "Tournament",
          "schema": {
            "$ref": "#/backend/entities/Tournament"
          },
          "description": "Stores tournament information."
        }
      },
      {
        "path": "/tournaments/{tournamentId}/registrations/{registrationId}",
        "definition": {
          "entityName": "Registration",
          "schema": {
            "$ref": "#/backend/entities/Registration"
          },
          "description": "Stores registration information for each tournament."
        }
      },
      {
        "path": "/announcements/{announcementId}",
        "definition": {
          "entityName": "Announcement",
          "schema": {
            "$ref": "#/backend/entities/Announcement"
          },
          "description": "Stores global announcements."
        }
      },
      {
        "path": "/highlights/{highlightId}",
        "definition": {
          "entityName": "Highlight",
          "schema": {
            "$ref": "#/backend/entities/Highlight"
          },
          "description": "Stores AI-generated match highlights."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles."
        }
      },
       {
        "path": "/users/{userId}/joinedTournaments/{tournamentId}",
        "definition": {
          "entityName": "JoinedTournament",
          "schema": { "$ref": "#/backend/entities/JoinedTournament" },
          "description": "Stores denormalized data for tournaments a user has joined for easy display."
        }
      },
      {
        "path": "/users/{userId}/wonTournaments/{tournamentId}",
        "definition": {
          "entityName": "WonTournament",
          "schema": { "$ref": "#/backend/entities/WonTournament" },
          "description": "Stores denormalized records of tournaments a user has won."
        }
      },
      {
        "path": "/users/{userId}/addCoinRequests/{requestId}",
        "definition": {
          "entityName": "PlayerAddCoinRequest",
          "schema": { "$ref": "#/backend/entities/PlayerAddCoinRequest" },
          "description": "Stores a player's private history of coin addition requests."
        }
      },
      {
        "path": "/users/{userId}/withdrawCoinRequests/{requestId}",
        "definition": {
          "entityName": "PlayerWithdrawCoinRequest",
          "schema": { "$ref": "#/backend/entities/PlayerWithdrawCoinRequest" },
          "description": "Stores a player's private history of coin withdrawal requests."
        }
      },
      {
        "path": "/addCoinRequests/{requestId}",
        "definition": {
          "entityName": "AddCoinRequest",
          "schema": { "$ref": "#/backend/entities/AddCoinRequest" },
          "description": "Global collection for admin review of coin addition requests."
        }
      },
      {
        "path": "/withdrawCoinRequests/{requestId}",
        "definition": {
          "entityName": "WithdrawCoinRequest",
          "schema": { "$ref": "#/backend/entities/WithdrawCoinRequest" },
          "description": "Global collection for admin review of coin withdrawal requests."
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores game categories for tournaments."
        }
      }
    ],
    "reasoning": "The 'coinRequests' collection has been split into 'addCoinRequests' and 'withdrawCoinRequests' to simplify security rules. This avoids complex rules for querying based on the 'type' field, which was causing permission errors for admin users trying to list all pending requests. Each new collection now has a simple, direct rule allowing admins full access, while players can only create and read their own requests. This is a more robust and secure data model."
  }
}

    